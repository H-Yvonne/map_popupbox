!function(a,b,c){"function"==typeof define&&(define.cmd||define.amd)?define(function(){return c(a,b)}):a.Map=c(a,b)}(window,$,function(a,b){var c=!!window.ActiveXObject&&!window.XMLHttpRequest,d=b(window),e=b("html"),f=b("body"),g={},h=null,i=function(a,b,c){this.setDefault(a,b,c),this.init()};b.extend(i.prototype,{init:function(){var a=this;a.getWinWH(),a._renderWarp(),a.resizeWH(),a.mainMap()},setDefault:function(a,b,c){this.coordinate=a,this.starting=c?c:"",this.target=b},resizeWH:function(){var a=this;d.resize(function(){a.getWinWH()})},getWinWH:function(){g.winWidth=d.width(),g.winHeight=d.height()}}),b.extend(i.prototype,{$_warp:"",$_main:"",$_mapwarp:"",$_route:"",_renderWarp:function(){var a='<div class="map_layer">			<div class="map_bg_layer"></div>			<div class="map_main">				<div class="map_box">					<div class="map_box_left">						<span class="mpl_title">交通驾车查询</span>						<div class="mpl_bg">							<div class="mpl_sel_warp">								<ul class="mpl_sel_list clearfix">									<li class="it">										<a href="javascript:;" class="mpl_sel_btn mpl_active_btn" data-attr="taxi">											<span class="map_icon mpl_taxi_icon"></span>										</a>									</li>									<li class="it">										<a href="javascript:;" class="mpl_sel_btn" data-attr="bus">											<span class="map_icon mpl_bus_icon"></span>										</a>									</li>									<li class="it">										<a href="javascript:;" class="mpl_sel_btn" data-attr="walk">											<span class="map_icon mpl_people_icon"></span>										</a>									</li>								</ul>							</div>							<div class="mpl_input_warp">								<ul class="mpl_input_list clearfix">									<li class="it">										<span class="map_icon mpl_start_icon"></span>										<input type="text" class="mpl_route_input" placeholder="起点" value="'+this.starting+'" node-type="start" />									</li>									<li class="it">										<span class="map_icon mpl_end_icon"></span>										<input type="text" class="mpl_route_input" placeholder="终点" value="'+this.target+'" node-type="end" />									</li>								</ul>							</div>							<a href="javascript:;" class="mpl_search_btn">查询路线</a>						</div>						<div class="mpl_route_detail"></div>					</div>					<div class="map_box_right">						<div class="map_box_warp"></div>					</div>				</div>			</div>		</div>';this._setHidden(),this.$_warp=b(a),this._setPosition(),f.append(this.$_warp),this.$_main=this.$_warp.find(".map_main"),this.$_mapwarp=this.$_warp.find(".map_box_warp"),this.$_route=this.$_warp.find(".mpl_route_detail"),this._warpControl(),this._setSize(),this._resizeFn()},_setHidden:function(){e.css({overflow:"hidden"})},_setVisible:function(){e.css({overflow:"auto"})},_setPosition:function(){if(c){var a=d.scrollTop();this.$_warp.css({position:"absolute",top:a,left:0})}else this.$_warp.css({position:"fixed",top:0,left:0})},_resizeFn:function(){var a=this;d.resize(function(){a._setSize()})},_setSize:function(){var a=this;a.$_warp.find(".map_box").css({height:(g.winWidth-100)/2}),a.$_warp.find(".mpl_route_detail").css({height:(g.winWidth-100)/2-203});var b=a.$_main.height();a.$_main.css({width:g.winWidth-100,top:(g.winHeight-b)/2})},_warpControl:function(){var a=this;d.on("keydown",function(b){27==b.keyCode&&a._warpClose()}),j("../src/js/windowInOutEvent.js","inOut",function(b){b(a.$_main,"",function(){a._warpClose()},0,!0)})},_warpClose:function(){this._setVisible(),d.unbind("keydown"),this.hide()}}),b.extend(i.prototype,{$_map:"",BMap:"",mainMap:function(){var a=this;j("http://api.map.baidu.com/getscript?v=2.0&ak=3130698f176dbaefabeb924855d7801d&services=&t=20140825185308","BMap",function(b){a.BMap=b,a.initMap(),a.addControl(),a.geocoder(),a.checkInit()})},initMap:function(){var a=this;a.$_map=new a.BMap.Map(a.$_mapwarp[0]),a.$_map.centerAndZoom(new a.BMap.Point(a.coordinate[0],a.coordinate[1]),11)},addControl:function(){var a=this;a.$_map.addControl(new a.BMap.NavigationControl),a.$_map.addControl(new a.BMap.OverviewMapControl),a.$_map.addControl(new a.BMap.MapTypeControl),a.$_map.enableScrollWheelZoom()},geocoder:function(){var a,b=this,c=new b.BMap.Geocoder;c.getPoint(b.target,function(c){c&&(a=new b.BMap.Marker(c),b.$_map.centerAndZoom(c,16),b.$_map.addOverlay(a))},new b.BMap.Point(b.coordinate[0],b.coordinate[1]))}}),b.extend(i.prototype,{$_type:"taxi",checkInit:function(){this.switchCheck(),this.checkTaxi(),this.checkBus(),this.checkWalk(),this.submitCheck(),this.starting&&this.checkRoute()},switchCheck:function(){var a=this,c=a.$_warp.find(".mpl_sel_btn");c.bind("click",function(){c.removeClass("mpl_active_btn"),b(this).addClass("mpl_active_btn"),a.$_type=b(this).attr("data-attr"),a.checkRoute()})},submitCheck:function(){var a=this;a.$_warp.find(".mpl_search_btn").bind("click",function(){a.checkRoute()})},checkRoute:function(){var a=this,b=a.$_warp.find('input[node-type="start"]'),c=a.$_warp.find('input[node-type="end"]'),d=b.val(),e=c.val();switch(d?b.blur().css({border:"1px solid #b2b2b2"}):b.focus().css({border:"1px solid #cc3300"}),e?c.blur().css({border:"1px solid #b2b2b2"}):c.focus().css({border:"1px solid #cc3300"}),a.$_type){case"taxi":a.$_taxi.search(d,e);break;case"bus":a.$_bus.search(d,e);break;case"walk":a.$_walk.search(d,e)}}}),b.extend(i.prototype,{$_taxi:"",$_bus:"",$_walk:"",checkTaxi:function(){var a=this;a.$_taxi=new a.BMap.DrivingRoute(a.$_map,{renderOptions:{map:a.$_map,panel:a.$_route[0]}})},checkBus:function(){var a=this;a.$_bus=new a.BMap.TransitRoute(a.$_map,{renderOptions:{map:a.$_map,panel:a.$_route[0]}})},checkWalk:function(){var a=this;a.$_walk=new a.BMap.WalkingRoute(a.$_map,{renderOptions:{map:a.$_map,panel:a.$_route[0]}})}}),b.extend(i.prototype,{show:function(a,b,c){this.$_warp.find('input[node-type="start"]').val(c),this.$_warp.find('input[node-type="end"]').val(b),this.setDefault(a,b,c),this.$_warp.show(),this._warpControl()},hide:function(){this.$_warp.hide()}});var j=function(c,d,e){a[d]?e&&e(a[d]):b.getScript(c,function(){e&&e(a[d])})};return function(a,b,c){h?h.show(a,b,c):h=new i(a,b,c)}}),function(){var a,b=function(b,c,d,e,f){var g=this;a||(a=$("body")),g.obj=b,g.inFnc=c,g.outfn=d,g.t=e,g.clearFn=f,setTimeout(function(){g.init()},0)};$.extend(b.prototype,{init:function(){var b=this,c=[!1,!1],d=0;b.t=b.t||0,b.random=(1e5*Math.random()|0).toString(16),a.unbind("click."+b.random),b.obj.bind("click."+b.random,function(){c[0]=!0}),a.unbind("click."+b.random).bind("click."+b.random,function(a){return d<b.t?void d++:(c[1]=!0,c[0]&&c[1]?b.inFn(a,b.inFnc):b.outFn(a,b.outfn,b.clearFn),void(c=[!1,!1]))})},inFn:function(a,b){"function"==typeof b&&b(a,this.random)},outFn:function(b,c,d){"function"==typeof c&&(c(b,this.random),d&&a.unbind("click."+this.random))},unbindEvent:function(){a.unbind("click."+this.random)}}),window.inOut=function(a,c,d,e,f){return new b(a,c,d,e,f)}}();